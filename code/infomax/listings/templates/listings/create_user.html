{% load static %}
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="description" content="Création de bons de dépôt"/>
        <link rel="stylesheet" href="{% static 'admin/css/create_user.css' %}">
        <title>Ajouter un utilisateur</title>
    </head>
    
    
    <!-- Pour afficher les users, il faut utiliser la liste des users : exemple : {{users[0]} pour afficher le premier user.
         Pour tous les afficher il faut faire une boucle for }
        le boolean 'edit' indique si on est en train de modifier un user
        Paramètre dispo : 
        form : formulaire pour la création de user
        form_edition : formulaire pour l'édition
        users : liste de tout les users
    
        -->
    
    <body>
    <header>
        {% include "vraitemplate/haut_de_page.html" %}
    </header>
    <main>
        <form method="post" action="{% url 'gestion_user' %}">
            {% csrf_token %}
            <h1> GESTION DES UTILISATEURS</h1>
    
        <div class="table_container">
            <table class="users_list">
                <thead>
                    <th>Liste des utilisateurs</th>
                    <th>Poste</th>
                    <th>action</th>
                </thead>
                <tbody>
                        {% for user1 in users %}
                        <tr>
                            
                            {% if not edit or not user1.username == username_edit %}
                            <td>{{ user1.username}}</td>
                            <td><div id="stringPoste">{{ user1.get_poste_display }}</div><div class="selectPoste" id="selectPoste">{{ form_edition.poste }}</div></td>
                            <td><input type="hidden" name="username_to_edit" value="{{ user.username }}"><button type="button" class="edit_suppr" id="edit" onclick="editButton()">Editer</button> / <button type="button" class="edit_suppr " id="suppr" onclick="openPopup()">Supprimer</a></td>

                            
                            {% else %}
                            <!-- Modifier ici pour l'édition comme Théophile avait demandé 
                            Les boutons ,styles etc.. sont à modifier j'ai mis des trucs par défaut 
                            -->
    
                            <td>{{ user1.username}}</td>
                            <td class="edit_poste">{{form_edition.poste }}</td>
                            <td><button type="submit" class="edit_suppr">Confirmer</button> / <a href="{% url 'supprimer_user' user1.username %}" class="edit_suppr" onclick="openPopup()">Supprimer</a></td>
                            {% endif%}
                        </tr>
                        {% endfor %}
                </tbody>
            </table>
            
            <div class="popup" id="popup">
                <h2>Supprimer l'utilisateur ?</h2>
                <button type="submit" class="suppr confirm" onclick="closePopup()">Confirmer</button>
                <button type="button" class="suppr annul" onclick="closePopup()">Annuler</button>
            </div>

        </div>
        </form>
        <div class="ajt_user">
            <form class="grid-form"  method="post" novalidate>
                {% csrf_token %}
                <div class="ajt_user_tab">
                    <table class="table_ajt">
                        <thead>
                            <th colspan="4">Ajouter un utilisateur</th>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="tab_label"><label for="{{form.first_name.id_for_label}}">prénom:</label></td>
                                <td class="tab_input"><div class="div_input"></div>{{form.first_name}}</td>
                                <td class="tab_label"><label for="{{form.last_name.id_for_label}}">nom:</label></td>
                                <td class="tab_input"><div class="div_input"></div>{{form.last_name}}</td>
                            </tr>
                            <tr>
                                <td class="tab_label"><label for="{{form.poste.id_for_label}}">poste:</label></td>
                                <td class="tab_input"><div class="div_select"></div>{{form.poste}}</td>
                                <td class="tab_label"><label for="{{form.password.id_for_label}}">Email:</label></td>
                                <td class="tab_input"><div class="div_input"></div>{{form.email}}</td>
                            </tr>
                            <tr>
                                <td colspan="4" class="submit"><input type="submit" value="créer un utilisateur" class="submit_button"></td>
                            </tr>
                        </tbody>
                        
                    </table>
                    
                </div>
    
                
                
            </form>
        </div>
    
        
    </main>
    <script>
        let popup = document.getElementById("popup");
        var etat = ["Editer","Confirmer"];
        var changeEtat = 0;
        let selectPoste = document.getElementById("selectPoste");
        let stringPoste = document.getElementById("stringPoste");        

        function openPopup(){
            popup.classList.add("open_popup")
        }

        function closePopup(){
            popup.classList.remove("open_popup")
        }

        
        function editButton(){
            var edit = document.getElementById("edit");
            
            if (changeEtat % 2 === 0){
                edit.textContent = etat[1];
                selectPoste.classList.remove("selectPoste");
                stringPoste.classList.add("stringPoste");
                changeEtat = changeEtat + 1;
                edit.type = "button";

            } else {
                changeEtat = changeEtat + 1;
                edit.textContent = etat[0];
                selectPoste.classList.add("selectPoste");
                stringPoste.classList.remove("stringPoste");
                edit.type ="submit";
            }            
            
        }
        

        

    </script>
    </body>
</html>
